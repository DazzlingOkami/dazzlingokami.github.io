<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="耀眼的大神">
    
    <title>
        
            Recommended C style and coding rules |
        
        耀眼的大神
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/blog.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"dazzlingokami.github.io","root":"/","language":"zh-CN","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":false,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/face.jpg","favicon":"/images/blog.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"trigger":"auto","unescape":false,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                耀眼的大神
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Recommended C style and coding rules</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/face.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">耀眼的大神</span>
                        
                            <span class="author-label">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2021-01-21 16:26:00</span>
        <span class="mobile">2021-01-21 16:26</span>
    </span>
    
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>This document describes C code style used by <a class="link"   target="_blank" rel="noopener" href="https://github.com/MaJerle" >Tilen MAJERLE<i class="fas fa-external-link-alt"></i></a> in his projects and libraries.</p>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li><a href="#the-single-most-important-rule">The single most important rule</a></li>
<li><a href="#recommended-c-style-and-coding-rules">Recommended C style and coding rules</a></li>
<li><a href="#general-rules">General rules</a></li>
<li><a href="#comments">Comments</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#variables">Variables</a></li>
<li><a href="#structures-enumerations-typedefs">Structures, enumerations, typedefs</a></li>
<li><a href="#compound-statements">Compound statements</a><ul>
<li><a href="#switch-statement">Switch statement</a></li>
</ul>
</li>
<li><a href="#macros-and-preprocessor-directives">Macros and preprocessor directives</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#headersource-files">Header/source files</a></li>
<li><a href="#artistic-style-configuration">Artistic Style configuration</a></li>
<li><a href="#eclipse-formatter">Eclipse formatter</a></li>
</ul>
<h2 id="The-single-most-important-rule"><a href="#The-single-most-important-rule" class="headerlink" title="The single most important rule"></a>The single most important rule</h2><p>Let’s start with the quote from <a class="link"   target="_blank" rel="noopener" href="https://developer.gnome.org/programming-guidelines/stable/c-coding-style.html.en" >GNOME developer<i class="fas fa-external-link-alt"></i></a> site.</p>
<blockquote>
<p>The single most important rule when writing code is this: <em>check the surrounding code and try to imitate it</em>.</p>
<p>As a maintainer it is dismaying to receive a patch that is obviously in a different coding style to the surrounding code. This is disrespectful, like someone tromping into a spotlessly-clean house with muddy shoes.</p>
<p>So, whatever this document recommends, if there is already written code and you are patching it, keep its current style consistent even if it is not your favorite style.</p>
</blockquote>
<h2 id="General-rules"><a href="#General-rules" class="headerlink" title="General rules"></a>General rules</h2><p>Here are listed most obvious and important general rules. Please check them carefully before you continue with other chapters.</p>
<ul>
<li><p>Use <code>C99</code> standard</p>
</li>
<li><p>Do not use tabs, use spaces instead</p>
</li>
<li><p>Use <code>4</code> spaces per indent level</p>
</li>
<li><p>Use <code>1</code> space between keyword and opening bracket</p>
</li>
<li><p>Do not use space between function name and opening bracket</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int32_t</span> a = sum(<span class="number">4</span>, <span class="number">3</span>);              <span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">int32_t</span> a = sum (<span class="number">4</span>, <span class="number">3</span>);             <span class="comment">/* Wrong */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Never use <code>__</code> or <code>_</code> prefix for variables/functions/macros/types. This is reserved for C language itself</p>
<ul>
<li>Prefer <code>prv_</code> name prefix for strictly module-private functions</li>
</ul>
</li>
<li><p>Use only lowercase characters for variables/functions/macros/types with optional underscore <code>_</code> char</p>
</li>
<li><p>Opening curly bracket is always at the same line as keyword (<code>for</code>, <code>while</code>, <code>do</code>, <code>switch</code>, <code>if</code>, …)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;           <span class="comment">/* OK */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)&#123;            <span class="comment">/* Wrong */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)             <span class="comment">/* Wrong */</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Use single space before and after comparison and assignment operators</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int32_t</span> a;</span><br><span class="line">a = <span class="number">3</span> + <span class="number">4</span>;              <span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">for</span> (a = <span class="number">0</span>; a &lt; <span class="number">5</span>; ++a) <span class="comment">/* OK */</span></span><br><span class="line">a=<span class="number">3</span>+<span class="number">4</span>;                  <span class="comment">/* Wrong */</span></span><br><span class="line">a = <span class="number">3</span>+<span class="number">4</span>;                <span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">for</span> (a=<span class="number">0</span>;a&lt;<span class="number">5</span>;++a)       <span class="comment">/* Wrong */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Use single space after every comma</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func_name(<span class="number">5</span>, <span class="number">4</span>);        <span class="comment">/* OK */</span></span><br><span class="line">func_name(<span class="number">4</span>,<span class="number">3</span>);         <span class="comment">/* Wrong */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Do not initialize <code>static</code> and <code>global</code> variables to <code>0</code> (or <code>NULL</code>), let compiler do it for you</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> a;       <span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> b = <span class="number">4</span>;   <span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int32_t</span> a = <span class="number">0</span>;   <span class="comment">/* Wrong */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int32_t</span>* ptr;<span class="comment">/* OK */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> abc = <span class="number">0</span>;<span class="comment">/* Wrong */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Declare all local variables of the same type in the same line</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">char</span> a;             <span class="comment">/* OK */</span></span><br><span class="line">    <span class="keyword">char</span> a, b;          <span class="comment">/* OK */</span></span><br><span class="line">    <span class="keyword">char</span> b;             <span class="comment">/* Wrong, variable with char type already exists */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Declare local variables in order</p>
<ol>
<li>Custom structures and enumerations</li>
<li>Integer types, wider unsigned type first</li>
<li>Single/Double floating point<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">my_func(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="comment">/* 1 */</span></span><br><span class="line">    <span class="keyword">my_struct_t</span> my;     <span class="comment">/* First custom structures */</span></span><br><span class="line">    <span class="keyword">my_struct_ptr_t</span>* p; <span class="comment">/* Pointers too */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 2 */</span></span><br><span class="line">    <span class="keyword">uint32_t</span> a;</span><br><span class="line">    <span class="keyword">int32_t</span> b;</span><br><span class="line">    <span class="keyword">uint16_t</span> c;</span><br><span class="line">    <span class="keyword">int16_t</span> g;</span><br><span class="line">    <span class="keyword">char</span> h;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 3 */</span></span><br><span class="line">    <span class="keyword">double</span> d;</span><br><span class="line">    <span class="keyword">float</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>Always declare local variables at the beginning of the block, before first executable statement</p>
</li>
<li><p>Declare counter variables in <code>for</code> loop</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* OK, if you need counter variable later */</span></span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (...) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">10</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">size_t</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) ...</span><br></pre></td></tr></table></figure></li>
<li><p>Avoid variable assignment with function call in declaration, except for single variables</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">a(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="comment">/* Avoid function calls when declaring variable */</span></span><br><span class="line">    <span class="keyword">int32_t</span> a, b = sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Use this */</span></span><br><span class="line">    <span class="keyword">int32_t</span> a, b;</span><br><span class="line">    b = sum(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This is ok */</span></span><br><span class="line">    <span class="keyword">uint8_t</span> a = <span class="number">3</span>, b = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Except <code>char</code>, <code>float</code> or <code>double</code>, always use types declared in <code>stdint.h</code> library, eg. <code>uint8_t</code> for <code>unsigned 8-bit</code>, etc.</p>
</li>
<li><p>Do not use <code>stdbool.h</code> library. Use <code>1</code> or <code>0</code> for <code>true</code> or <code>false</code> respectively</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">uint8_t</span> status;</span><br><span class="line">status = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="keyword">bool</span> status = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>Never compare against <code>true</code>, eg. <code>if (check_func() == 1)</code>, use <code>if (check_func()) &#123; ... &#125;</code></p>
</li>
<li><p>Always compare pointers against <code>NULL</code> value</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span>* ptr;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* OK, compare against NULL */</span></span><br><span class="line"><span class="keyword">if</span> (ptr == <span class="literal">NULL</span> || ptr != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">if</span> (ptr || !ptr) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Always use <em>pre-increment (and decrement respectively)</em> instead of <em>post-increment (and decrement respectively)</em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int32_t</span> a = <span class="number">0</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">a++;            <span class="comment">/* Wrong */</span></span><br><span class="line">++a;            <span class="comment">/* OK */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; ++j) &#123;&#125;  <span class="comment">/* OK */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Always use <code>size_t</code> for length or size variables</p>
</li>
<li><p>Always use <code>const</code> for pointer if function should not modify memory pointed to by <code>pointer</code></p>
</li>
<li><p>Always use <code>const</code> for function parameter or variable, if it should not be modified</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* When d could be modified, data pointed to by d could not be modified */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">const</span> <span class="keyword">void</span>* d) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* When d and data pointed to by d both could not be modified */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">const</span> <span class="keyword">void</span>* <span class="keyword">const</span> d) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Not required, it is advised */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">const</span> <span class="keyword">size_t</span> len) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* When d should not be modified inside function, only data pointed to by d could be modified */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">void</span>* <span class="keyword">const</span> d) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>When function may accept pointer of any type, always use <code>void *</code>, do not use <code>uint8_t *</code></p>
<ul>
<li>Function must take care of proper casting in implementation<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * To send data, function should not modify memory pointed to by `data` variable</span></span><br><span class="line"><span class="comment"> * thus `const` keyword is important</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * To send generic data (or to write them to file)</span></span><br><span class="line"><span class="comment"> * any type may be passed for data,</span></span><br><span class="line"><span class="comment"> * thus use `void *`</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* OK example */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">send_data(<span class="keyword">const</span> <span class="keyword">void</span>* data, <span class="keyword">size_t</span> len) &#123; <span class="comment">/* OK */</span></span><br><span class="line">    <span class="comment">/* Do not cast `void *` or `const void *` */</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">uint8_t</span>* d = data;<span class="comment">/* Function handles proper type for internal usage */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">send_data(<span class="keyword">const</span> <span class="keyword">void</span>* data, <span class="keyword">int</span> len) &#123;    <span class="comment">/* Wrong, not not use int */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Always use brackets with <code>sizeof</code> operator</p>
</li>
<li><p>Never use <em>Variable Length Array</em> (VLA). Use dynamic memory allocation instead with standard C <code>malloc</code> and <code>free</code> functions or if library/project provides custom memory allocation, use its implementation</p>
<ul>
<li>Take a look at <a class="link"   target="_blank" rel="noopener" href="https://github.com/MaJerle/lwmem" >LwMEM<i class="fas fa-external-link-alt"></i></a>, custom memory management library<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">size_t</span> size) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span>* arr;</span><br><span class="line">    arr = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(*arr) * n); <span class="comment">/* OK, Allocate memory */</span></span><br><span class="line">    arr = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span> *arr * n);  <span class="comment">/* Wrong, brackets for sizeof operator are missing */</span></span><br><span class="line">    <span class="keyword">if</span> (arr == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">/* FAIL, no memory */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(arr);  <span class="comment">/* Free memory after usage */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">size_t</span> size) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> arr[size];  <span class="comment">/* Wrong, do not use VLA */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Always compare variable against zero, except if it is treated as <code>boolean</code> type</p>
</li>
<li><p>Never compare <code>boolean-treated</code> variables against zero or one. Use NOT (<code>!</code>) instead</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> length = <span class="number">5</span>;  <span class="comment">/* Counter variable */</span></span><br><span class="line"><span class="keyword">uint8_t</span> is_ok = <span class="number">0</span>;  <span class="comment">/* Boolean-treated variable */</span></span><br><span class="line"><span class="keyword">if</span> (length)         <span class="comment">/* Wrong, length is not treated as boolean */</span></span><br><span class="line"><span class="keyword">if</span> (length &gt; <span class="number">0</span>)     <span class="comment">/* OK, length is treated as counter variable containing multi values, not only 0 or 1 */</span></span><br><span class="line"><span class="keyword">if</span> (length == <span class="number">0</span>)    <span class="comment">/* OK, length is treated as counter variable containing multi values, not only 0 or 1 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_ok)          <span class="comment">/* OK, variable is treated as boolean */</span></span><br><span class="line"><span class="keyword">if</span> (!is_ok)         <span class="comment">/* OK, -||- */</span></span><br><span class="line"><span class="keyword">if</span> (is_ok == <span class="number">1</span>)     <span class="comment">/* Wrong, never compare boolean variable against 1! */</span></span><br><span class="line"><span class="keyword">if</span> (is_ok == <span class="number">0</span>)     <span class="comment">/* Wrong, use ! for negative check */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Always use <code>/* comment */</code> for comments, even for <em>single-line</em> comment</p>
</li>
<li><p>Always include check for <code>C++</code> with <code>extern</code> keyword in header file</p>
</li>
<li><p>Every function must include <em>doxygen-enabled</em> comment, even if function is <code>static</code></p>
</li>
<li><p>Use English names/text for functions, variables, comments</p>
</li>
<li><p>Use <em>lowercase</em> characters for variables</p>
</li>
<li><p>Use <em>underscore</em> if variable contains multiple names, eg. <code>force_redraw</code>. Do not use <code>forceRedraw</code></p>
</li>
<li><p>Never cast function returning <code>void *</code>, eg. <code>uint8_t* ptr = (uint8_t *)func_returning_void_ptr();</code> as <code>void *</code> is safely promoted to any other pointer type</p>
<ul>
<li>Use <code>uint8_t* ptr = func_returning_void_ptr();</code> instead</li>
</ul>
</li>
<li><p>Always use <code>&lt;</code> and <code>&gt;</code> for C Standard Library include files, eg. <code>#include &lt;stdlib.h&gt;</code></p>
</li>
<li><p>Always use <code>&quot;&quot;</code> for custom libraries, eg. <code>#include &quot;my_library.h&quot;</code></p>
</li>
<li><p>When casting to pointer type, always align asterisk to type, eg. <code>uint8_t* t = (uint8_t*)var_width_diff_type</code></p>
</li>
<li><p>Always respect code style already used in project or library</p>
</li>
</ul>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><ul>
<li><p>Comments starting with <code>//</code> are not allowed. Always use <code>/* comment */</code>, even for single-line comment</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//This is comment (wrong)</span></span><br><span class="line"><span class="comment">/* This is comment (ok) */</span></span><br></pre></td></tr></table></figure></li>
<li><p>For multi-line comments use <code>space+asterisk</code> for every line</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * This is multi-line comments,</span></span><br><span class="line"><span class="comment"> * written in 2 lines (ok)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Wrong, use double-asterisk only for doxygen documentation</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Single line comment without space before asterisk (wrong)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Single line comment in multi-line configuration (wrong)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Single line comment (ok) */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Use <code>12</code> indents (<code>12 * 4</code> spaces) offset when commenting. If statement is larger than <code>12</code> indents, make comment <code>4-spaces</code> aligned (examples below) to next available indent</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">my_func(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">char</span> a, b;</span><br><span class="line"></span><br><span class="line">    a = call_func_returning_char_a(a);          <span class="comment">/* This is comment with 12*4 spaces indent from beginning of line */</span></span><br><span class="line">    b = call_func_returning_char_a_but_func_name_is_very_long(a);   <span class="comment">/* This is comment, aligned to 4-spaces indent */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2></li>
<li><p>Every function which may have access from outside its module, must include function <em>prototype</em> (or <em>declaration</em>)</p>
</li>
<li><p>Function name must be lowercase, optionally separated with underscore <code>_</code> character</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">my_func</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myfunc</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MYFunc</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">myFunc</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>When function returns pointer, align asterisk to return type</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="title">my_func</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">my_struct_t</span>* <span class="title">my_func</span><span class="params">(<span class="keyword">int32_t</span> a, <span class="keyword">int32_t</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">my_func</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">my_struct_t</span> * <span class="title">my_func</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>Align all function prototypes (with the same/similar functionality) for better readability</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK, function names aligned */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>        <span class="title">set</span><span class="params">(<span class="keyword">int32_t</span> a)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">my_type_t</span>   <span class="title">get</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">my_ptr_t</span>*   <span class="title">get_ptr</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int32_t</span> a)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> * <span class="title">get</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure></li>
<li><p>Function implementation must include return type and optional other keywords in separate line</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">int32_t</span></span><br><span class="line">foo(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span>*</span><br><span class="line">get_string(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello world!\r\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="function"><span class="keyword">int32_t</span> <span class="title">foo</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>When function returns pointer, asterisk character must be aligned to return type (<code>char*</code>)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>*</span><br><span class="line">foo(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>*</span><br><span class="line">foo(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h2></li>
<li><p>Make variable name all lowercase with optional underscore <code>_</code> character</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">int32_t</span> a;</span><br><span class="line"><span class="keyword">int32_t</span> my_var;</span><br><span class="line"><span class="keyword">int32_t</span> myvar;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">int32_t</span> A;</span><br><span class="line"><span class="keyword">int32_t</span> myVar;</span><br><span class="line"><span class="keyword">int32_t</span> MYVar;</span><br></pre></td></tr></table></figure></li>
<li><p>Group local variables together by <code>type</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">foo(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> a, b;   <span class="comment">/* OK */</span></span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">    <span class="keyword">char</span> b;         <span class="comment">/* Wrong, char type already exists */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Do not declare variable after first executable statement</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">foo(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> a;</span><br><span class="line">    a = bar();</span><br><span class="line">    <span class="keyword">int32_t</span> b;      <span class="comment">/* Wrong, there is already executable statement */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>You may declare new variables inside next indent level</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int32_t</span> a, b;</span><br><span class="line">a = foo();</span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> c, d;   <span class="comment">/* OK, c and d are in if-statement scope */</span></span><br><span class="line">    c = foo();</span><br><span class="line">    <span class="keyword">int32_t</span> e;      <span class="comment">/* Wrong, there was already executable statement inside block */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Declare pointer variables with asterisk aligned to type</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">char</span>* a;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">char</span> *a;</span><br><span class="line"><span class="keyword">char</span> * a;</span><br></pre></td></tr></table></figure></li>
<li><p>When declaring multiple pointer variables, you may declare them with asterisk aligned to variable name</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">char</span> *p, *n;</span><br></pre></td></tr></table></figure>
<h2 id="Structures-enumerations-typedefs"><a href="#Structures-enumerations-typedefs" class="headerlink" title="Structures, enumerations, typedefs"></a>Structures, enumerations, typedefs</h2></li>
<li><p>Structure or enumeration name must be lowercase with optional underscore <code>_</code> character between words</p>
</li>
<li><p>Structure or enumeration may contain <code>typedef</code> keyword</p>
</li>
<li><p>All structure members must be lowercase</p>
</li>
<li><p>All enumeration members must be uppercase</p>
</li>
<li><p>Structure/enumeration must follow doxygen documentation syntax</p>
</li>
</ul>
<p>When structure is declared, it may use one of <code>3</code> different options:</p>
<ol>
<li>When structure is declared with <em>name only</em>, it <em>must not</em> contain <code>_t</code> suffix after its name.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">struct_name</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>* a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li>When structure is declared with <em>typedef only</em>, it <em>has to</em> contain <code>_t</code> suffix after its name.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>* a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">&#125; <span class="keyword">struct_name_t</span>;</span><br></pre></td></tr></table></figure></li>
<li>When structure is declared with <em>name and typedef</em>, it <em>must not</em> contain <code>_t</code> for basic name and it <em>has to</em> contain <code>_t</code> suffix after its name for typedef part.<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">struct_name</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>* a;</span><br><span class="line">    <span class="keyword">char</span> b;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">&#125; <span class="keyword">struct_name_t</span>;</span><br></pre></td></tr></table></figure>
Examples of bad declarations and their suggested corrections<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* a and b must be separated to 2 lines */</span></span><br><span class="line"><span class="comment">/* Name of structure with typedef must include _t suffix */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int32_t</span> a, b;</span><br><span class="line">&#125; a;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Corrected version */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int32_t</span> a;</span><br><span class="line">    <span class="keyword">int32_t</span> b;</span><br><span class="line">&#125; <span class="keyword">a_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong name, it must not include _t suffix */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">name_t</span> &#123;</span></span><br><span class="line">    <span class="keyword">int32_t</span> a;</span><br><span class="line">    <span class="keyword">int32_t</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong parameters, must be all uppercase */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    MY_ENUM_TESTA,</span><br><span class="line">    my_enum_testb,</span><br><span class="line">&#125; <span class="keyword">my_enum_t</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>When initializing structure on declaration, use <code>C99</code> initialization style</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">a_t</span> a = &#123;</span><br><span class="line">    .a = <span class="number">4</span>,</span><br><span class="line">    .b = <span class="number">5</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">a_t</span> a = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p>When new typedef is introduced for function handles, use <code>_fn</code> suffix</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Function accepts 2 parameters and returns uint8_t */</span></span><br><span class="line"><span class="comment">/* Name of typedef has `_fn` suffix */</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">uint8_t</span> <span class="params">(*my_func_typedef_fn)</span><span class="params">(<span class="keyword">uint8_t</span> p1, <span class="keyword">const</span> <span class="keyword">char</span>* p2)</span></span>;</span><br></pre></td></tr></table></figure>
<h2 id="Compound-statements"><a href="#Compound-statements" class="headerlink" title="Compound statements"></a>Compound statements</h2></li>
<li><p>Every compound statement must include opening and closing curly bracket, even if it includes only <code>1</code> nested statement</p>
</li>
<li><p>Every compound statement must include single indent; when nesting statements, include <code>1</code> indent size for each nest</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">if</span> (c) &#123;</span><br><span class="line">    do_a();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    do_b();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">if</span> (c)</span><br><span class="line">    do_a();</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    do_b();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">if</span> (c) do_a();</span><br><span class="line"><span class="keyword">else</span> do_b();</span><br></pre></td></tr></table></figure></li>
<li><p>In case of <code>if</code> or <code>if-else-if</code> statement, <code>else</code> must be in the same line as closing bracket of first statement</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (b) &#123;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>In case of <code>do-while</code> statement, <code>while</code> part must be in the same line as closing bracket of <code>do</code> part</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">int32_t</span> a;</span><br><span class="line">    a = do_a();</span><br><span class="line">    do_b(a);</span><br><span class="line">&#125; <span class="keyword">while</span> (check());</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line">&#125; <span class="keyword">while</span> (check());</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (check());</span><br></pre></td></tr></table></figure></li>
<li><p>Indentation is required for every opening bracket</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    do_a();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    do_b();</span><br><span class="line">    <span class="keyword">if</span> (c) &#123;</span><br><span class="line">        do_c();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Never do compound statement without curly bracket, even in case of single statement. Examples below show bad practices</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (a) do_b();</span><br><span class="line"><span class="keyword">else</span> do_c();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a) do_a(); <span class="keyword">else</span> do_b();</span><br></pre></td></tr></table></figure></li>
<li><p>Empty <code>while</code>, <code>do-while</code> or <code>for</code> loops must include brackets</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">while</span> (is_register_bit_set()) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">while</span> (is_register_bit_set());</span><br><span class="line"><span class="keyword">while</span> (is_register_bit_set()) &#123; &#125;</span><br><span class="line"><span class="keyword">while</span> (is_register_bit_set()) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>If <code>while</code> (or <code>for</code>, <code>do-while</code>, etc) is empty (it can be the case in embedded programming), use empty single-line brackets</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wait for bit to be set in embedded hardware unit</span></span><br><span class="line"><span class="comment">uint32_t* addr = HW_PERIPH_REGISTER_ADDR;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">/* Wait bit 13 to be ready */</span></span><br><span class="line"><span class="keyword">while</span> (*addr &amp; (<span class="number">1</span> &lt;&lt; <span class="number">13</span>)) &#123;&#125;        <span class="comment">/* OK, empty loop contains no spaces inside curly brackets */</span></span><br><span class="line"><span class="keyword">while</span> (*addr &amp; (<span class="number">1</span> &lt;&lt; <span class="number">13</span>)) &#123; &#125;       <span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">while</span> (*addr &amp; (<span class="number">1</span> &lt;&lt; <span class="number">13</span>)) &#123;         <span class="comment">/* Wrong */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (*addr &amp; (<span class="number">1</span> &lt;&lt; <span class="number">13</span>));          <span class="comment">/* Wrong, curly brackets are missing. Can lead to compiler warnings or unintentional bugs */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Always prefer using loops in this order: <code>for</code>, <code>do-while</code>, <code>while</code></p>
</li>
<li><p>Avoid incrementing variables inside loop block if possible, see examples</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Not recommended */</span></span><br><span class="line"><span class="keyword">int32_t</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (a &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    .</span><br><span class="line">    ..</span><br><span class="line">    ...</span><br><span class="line">    ++a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Better */</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> a = <span class="number">0</span>; a &lt; <span class="number">10</span>; ++a) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Better, if inc may not happen in every cycle */</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">size_t</span> a = <span class="number">0</span>; a &lt; <span class="number">10</span>; ) &#123;</span><br><span class="line">    <span class="keyword">if</span> (...) &#123;</span><br><span class="line">        ++a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Switch-statement"><a href="#Switch-statement" class="headerlink" title="Switch statement"></a>Switch statement</h3><ul>
<li><p>Add <em>single indent</em> for every <code>case</code> statement</p>
</li>
<li><p>Use additional <em>single indent</em> for <code>break</code> statement in each <code>case</code> or <code>default</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK, every case has single indent */</span></span><br><span class="line"><span class="comment">/* OK, every break has additional indent */</span></span><br><span class="line"><span class="keyword">switch</span> (check()) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        do_a();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        do_b();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong, case indent missing */</span></span><br><span class="line"><span class="keyword">switch</span> (check()) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">    do_a();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    do_b();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="keyword">switch</span> (check()) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        do_a();</span><br><span class="line">    <span class="keyword">break</span>;      <span class="comment">/* Wrong, break must have indent as it is under case */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    do_b();     <span class="comment">/* Wrong, indent under case is missing */</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Always include <code>default</code> statement</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="keyword">switch</span> (var) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        do_job();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong, default is missing */</span></span><br><span class="line"><span class="keyword">switch</span> (var) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        do_job();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>If local variables are required, use curly brackets and put <code>break</code> statement inside.</p>
<ul>
<li>Put opening curly bracket in the same line as <code>case</code> statement<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (a) &#123;</span><br><span class="line">    <span class="comment">/* OK */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">        <span class="keyword">int32_t</span> a, b;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        a = <span class="number">5</span>;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wrong */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int32_t</span> a;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wrong, break shall be inside */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">        <span class="keyword">int32_t</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Macros-and-preprocessor-directives"><a href="#Macros-and-preprocessor-directives" class="headerlink" title="Macros and preprocessor directives"></a>Macros and preprocessor directives</h2></li>
</ul>
</li>
<li><p>Always use macros instead of literal constants, specially for numbers</p>
</li>
<li><p>All macros must be fully uppercase, with optional underscore <code>_</code> character, except if they are clearly marked as function which may be in the future replaced with regular function syntax</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO(x)         ((x) * (x))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> square(x)           ((x) * (x))</span></span><br></pre></td></tr></table></figure></li>
<li><p>Always protect input parameters with parentheses</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN(x, y)           ((x) &lt; (y) ? (x) : (y))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN(x, y)           x &lt; y ? x : y</span></span><br></pre></td></tr></table></figure></li>
<li><p>Always protect final macro evaluation with parenthesis</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN(x, y)           (x) &lt; (y) ? (x) : (y)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SUM(x, y)           (x) + (y)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Imagine result of this equation using wrong SUM implementation */</span></span><br><span class="line"><span class="keyword">int32_t</span> x = <span class="number">5</span> * SUM(<span class="number">3</span>, <span class="number">4</span>);  <span class="comment">/* Expected result is 5 * 7 = 35 */</span></span><br><span class="line"><span class="keyword">int32_t</span> x = <span class="number">5</span> * (<span class="number">3</span>) + (<span class="number">4</span>);  <span class="comment">/* It is evaluated to this, final result = 19 which is not what we expect */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Correct implementation */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN(x, y)           ((x) &lt; (y) ? (x) : (y))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SUM(x, y)           ((x) + (y))</span></span><br></pre></td></tr></table></figure></li>
<li><p>When macro uses multiple statements, protect it using <code>do-while (0)</code> statement</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int32_t</span> px, py;</span><br><span class="line">&#125; <span class="keyword">point_t</span>;</span><br><span class="line"><span class="keyword">point_t</span> p;                  <span class="comment">/* Define new point */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong implementation */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Define macro to set point */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SET_POINT(p, x, y)  (p)-&gt;px = (x); (p)-&gt;py = (y)    <span class="comment">/* 2 statements. Last one should not implement semicolon */</span></span></span><br><span class="line"></span><br><span class="line">SET_POINT(&amp;p, <span class="number">3</span>, <span class="number">4</span>);        <span class="comment">/* Set point to position 3, 4. This evaluates to... */</span></span><br><span class="line">(&amp;p)-&gt;px = (<span class="number">3</span>); (&amp;p)-&gt;py = (<span class="number">4</span>); <span class="comment">/* ... to this. In this example this is not a problem. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Consider this ugly code, however it is valid by C standard (not recommended) */</span></span><br><span class="line"><span class="keyword">if</span> (a)                      <span class="comment">/* If a is true */</span></span><br><span class="line">    <span class="keyword">if</span> (b)                  <span class="comment">/* If b is true */</span></span><br><span class="line">        SET_POINT(&amp;p, <span class="number">3</span>, <span class="number">4</span>);<span class="comment">/* Set point to x = 3, y = 4 */</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        SET_POINT(&amp;p, <span class="number">5</span>, <span class="number">6</span>);<span class="comment">/* Set point to x = 5, y = 6 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Evaluates to code below. Do you see the problem? */</span></span><br><span class="line"><span class="keyword">if</span> (a)</span><br><span class="line">    <span class="keyword">if</span> (b)</span><br><span class="line">        (&amp;p)-&gt;px = (<span class="number">3</span>); (&amp;p)-&gt;py = (<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        (&amp;p)-&gt;px = (<span class="number">5</span>); (&amp;p)-&gt;py = (<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Or if we rewrite it a little */</span></span><br><span class="line"><span class="keyword">if</span> (a)</span><br><span class="line">    <span class="keyword">if</span> (b)</span><br><span class="line">        (&amp;p)-&gt;px = (<span class="number">3</span>);</span><br><span class="line">        (&amp;p)-&gt;py = (<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        (&amp;p)-&gt;px = (<span class="number">5</span>);</span><br><span class="line">        (&amp;p)-&gt;py = (<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Ask yourself a question: To which `if` statement `else` keyword belongs?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Based on first part of code, answer is straight-forward. To inner `if` statement when we check `b` condition</span></span><br><span class="line"><span class="comment"> * Actual answer: Compilation error as `else` belongs nowhere</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Better and correct implementation of macro */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SET_POINT(p, x, y)  do &#123; (p)-&gt;px = (x); (p)-&gt;py = (y); &#125; while (0)    <span class="comment">/* 2 statements. No semicolon after while loop */</span></span></span><br><span class="line"><span class="comment">/* Or even better */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SET_POINT(p, x, y)  do &#123;    \   <span class="comment">/* Backslash indicates statement continues in new line */</span></span></span><br><span class="line">    (p)-&gt;px = (x);                  \</span><br><span class="line">    (p)-&gt;py = (y);                  \</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>)                             <span class="comment">/* 2 statements. No semicolon after while loop */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Now original code evaluates to */</span></span><br><span class="line"><span class="keyword">if</span> (a)</span><br><span class="line">    <span class="keyword">if</span> (b)</span><br><span class="line">        <span class="keyword">do</span> &#123; (&amp;p)-&gt;px = (<span class="number">3</span>); (&amp;p)-&gt;py = (<span class="number">4</span>); &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">do</span> &#123; (&amp;p)-&gt;px = (<span class="number">5</span>); (&amp;p)-&gt;py = (<span class="number">6</span>); &#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Every part of `if` or `else` contains only `1` inner statement (do-while), hence this is valid evaluation */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* To make code perfect, use brackets for every if-ifelse-else statements */</span></span><br><span class="line"><span class="keyword">if</span> (a) &#123;                    <span class="comment">/* If a is true */</span></span><br><span class="line">    <span class="keyword">if</span> (b) &#123;                <span class="comment">/* If b is true */</span></span><br><span class="line">        SET_POINT(&amp;p, <span class="number">3</span>, <span class="number">4</span>);<span class="comment">/* Set point to x = 3, y = 4 */</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        SET_POINT(&amp;p, <span class="number">5</span>, <span class="number">6</span>);<span class="comment">/* Set point to x = 5, y = 6 */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Always write macro documentation as regular function with additional <code>hideinitializer</code> doxygen keyword</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO(x)         ((x) * 2)</span></span><br></pre></td></tr></table></figure></li>
<li><p>Avoid using <code>#ifdef</code> or <code>#ifndef</code>. Use <code>defined()</code> or <code>!defined()</code> instead</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> XYZ</span></span><br><span class="line"><span class="comment">/* do something */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* XYZ */</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>Always document <code>if/elif/else/endif</code> statements</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(XYZ)</span></span><br><span class="line"><span class="comment">/* Do if XYZ defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* defined(XYZ) */</span></span></span><br><span class="line"><span class="comment">/* Do if XYZ not defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* !defined(XYZ) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(XYZ)</span></span><br><span class="line"><span class="comment">/* Do if XYZ defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="comment">/* Do if XYZ not defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>Do not indent sub statements inside <code>#if</code> statement</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OK */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(XYZ)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(ABC)</span></span><br><span class="line"><span class="comment">/* do when ABC defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* defined(ABC) */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* defined(XYZ) */</span></span></span><br><span class="line"><span class="comment">/* Do when XYZ not defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* !defined(XYZ) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Wrong */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(XYZ)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> defined(ABC)</span></span><br><span class="line">        <span class="comment">/* do when ABC defined */</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* defined(ABC) */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span> <span class="comment">/* defined(XYZ) */</span></span></span><br><span class="line">    <span class="comment">/* Do when XYZ not defined */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* !defined(XYZ) */</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Documentation"><a href="#Documentation" class="headerlink" title="Documentation"></a>Documentation</h2></li>
</ul>
<p>Documented code allows doxygen to parse and general html/pdf/latex output, thus it is very important to do it properly.</p>
<ul>
<li><p>Use doxygen-enabled documentation style for <code>variables</code>, <code>functions</code> and <code>structures/enumerations</code></p>
</li>
<li><p>Always use <code>\</code> for doxygen, do not use <code>@</code></p>
</li>
<li><p>Always use <code>5x4</code> spaces (<code>5</code> tabs) offset from beginning of line for text</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Holds pointer to first entry in linked list</span></span><br><span class="line"><span class="comment"> *                  Beginning of this text is 5 tabs (20 spaces) from beginning of line</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span></span><br><span class="line"><span class="keyword">type_t</span>* <span class="built_in">list</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>Every structure/enumeration member must include documentation</p>
</li>
<li><p>Use <code>12x4 spaces</code> offset for beginning of comment</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           This is point struct</span></span><br><span class="line"><span class="comment"> * \note            This structure is used to calculate all point</span></span><br><span class="line"><span class="comment"> *                      related stuff</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int32_t</span> x;                                  <span class="comment">/*!&lt; Point X coordinate */</span></span><br><span class="line">    <span class="keyword">int32_t</span> y;                                  <span class="comment">/*!&lt; Point Y coordinate */</span></span><br><span class="line">    <span class="keyword">int32_t</span> size;                               <span class="comment">/*!&lt; Point size.</span></span><br><span class="line"><span class="comment">                                                    Since comment is very big,</span></span><br><span class="line"><span class="comment">                                                    you may go to next line */</span></span><br><span class="line">&#125; <span class="keyword">point_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Point color enumeration</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    COLOR_RED,                                  <span class="comment">/*!&lt; Red color. This comment has 12x4</span></span><br><span class="line"><span class="comment">                                                    spaces offset from beginning of line */</span></span><br><span class="line">    COLOR_GREEN,                                <span class="comment">/*!&lt; Green color */</span></span><br><span class="line">    COLOR_BLUE,                                 <span class="comment">/*!&lt; Blue color */</span></span><br><span class="line">&#125; <span class="keyword">point_color_t</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>Documentation for functions must be written in function implementation (source file usually)</p>
</li>
<li><p>Function must include <code>brief</code> and all parameters documentation</p>
</li>
<li><p>Every parameter must be noted if it is <code>in</code> or <code>out</code> for <em>input</em> and <em>output</em> respectively</p>
</li>
<li><p>Function must include <code>return</code> parameter if it returns something. This does not apply for <code>void</code> functions</p>
</li>
<li><p>Function can include other doxygen keywords, such as <code>note</code> or <code>warning</code></p>
</li>
<li><p>Use colon <code>:</code> between parameter name and its description</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Sum `2` numbers</span></span><br><span class="line"><span class="comment"> * \param[in]       a: First number</span></span><br><span class="line"><span class="comment"> * \param[in]       b: Second number</span></span><br><span class="line"><span class="comment"> * \return          Sum of input values</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int32_t</span></span><br><span class="line">sum(<span class="keyword">int32_t</span> a, <span class="keyword">int32_t</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Sum `2` numbers and write it to pointer</span></span><br><span class="line"><span class="comment"> * \note            This function does not return value, it stores it to pointer instead</span></span><br><span class="line"><span class="comment"> * \param[in]       a: First number</span></span><br><span class="line"><span class="comment"> * \param[in]       b: Second number</span></span><br><span class="line"><span class="comment"> * \param[out]      result: Output variable used to save result</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">void_sum(<span class="keyword">int32_t</span> a, <span class="keyword">int32_t</span> b, <span class="keyword">int32_t</span>* result) &#123;</span><br><span class="line">    *result = a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>If function returns member of enumeration, use <code>ref</code> keyword to specify which one</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           My enumeration</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    MY_ERR,                                     <span class="comment">/*!&lt; Error value */</span></span><br><span class="line">    MY_OK                                       <span class="comment">/*!&lt; OK value */</span></span><br><span class="line">&#125; <span class="keyword">my_enum_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Check some value</span></span><br><span class="line"><span class="comment"> * \return          \ref MY_OK on success, member of \ref my_enum_t otherwise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">my_enum_t</span></span><br><span class="line">check_value(<span class="keyword">void</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> MY_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Use notation (`NULL` =&gt; <code>NULL</code>) for constants or numbers</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Get data from input array</span></span><br><span class="line"><span class="comment"> * \param[in]       in: Input data</span></span><br><span class="line"><span class="comment"> * \return          Pointer to output data on success, `NULL` otherwise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">void</span> *</span><br><span class="line">get_data(<span class="keyword">const</span> <span class="keyword">void</span>* in) &#123;</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Documentation for macros must include <code>hideinitializer</code> doxygen command</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \brief           Get minimal value between `x` and `y`</span></span><br><span class="line"><span class="comment"> * \param[in]       x: First value</span></span><br><span class="line"><span class="comment"> * \param[in]       y: Second value</span></span><br><span class="line"><span class="comment"> * \return          Minimal value between `x` and `y`</span></span><br><span class="line"><span class="comment"> * \hideinitializer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN(x, y)       ((x) &lt; (y) ? (x) : (y))</span></span><br></pre></td></tr></table></figure>
<h2 id="Header-source-files"><a href="#Header-source-files" class="headerlink" title="Header/source files"></a>Header/source files</h2></li>
<li><p>Leave single empty line at the end of file</p>
</li>
<li><p>Every file must include doxygen annotation for <code>file</code> and <code>brief</code> description followed by empty line (when using doxygen)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \file            template.h</span></span><br><span class="line"><span class="comment"> * \brief           Template include file</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">                    <span class="comment">/* Here is empty line */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Every file (<em>header</em> or <em>source</em>) must include license (opening comment includes single asterisk as this must be ignored by doxygen)</p>
</li>
<li><p>Use the same license as already used by project/library</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * \file            template.h</span></span><br><span class="line"><span class="comment"> * \brief           Template include file</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) year FirstName LASTNAME</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Permission is hereby granted, free of charge, to any person</span></span><br><span class="line"><span class="comment"> * obtaining a copy of this software and associated documentation</span></span><br><span class="line"><span class="comment"> * files (the &quot;Software&quot;), to deal in the Software without restriction,</span></span><br><span class="line"><span class="comment"> * including without limitation the rights to use, copy, modify, merge,</span></span><br><span class="line"><span class="comment"> * publish, distribute, sublicense, and/or sell copies of the Software,</span></span><br><span class="line"><span class="comment"> * and to permit persons to whom the Software is furnished to do so,</span></span><br><span class="line"><span class="comment"> * subject to the following conditions:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The above copyright notice and this permission notice shall be</span></span><br><span class="line"><span class="comment"> * included in all copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span></span><br><span class="line"><span class="comment"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span></span><br><span class="line"><span class="comment"> * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE</span></span><br><span class="line"><span class="comment"> * AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</span></span><br><span class="line"><span class="comment"> * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</span></span><br><span class="line"><span class="comment"> * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span></span><br><span class="line"><span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span></span><br><span class="line"><span class="comment"> * OTHER DEALINGS IN THE SOFTWARE.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This file is part of library_name.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Author:          FirstName LASTNAME &lt;optional_email@example.com&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></li>
<li><p>Header file must include guard <code>#ifndef</code></p>
</li>
<li><p>Header file must include <code>C++</code> check</p>
</li>
<li><p>Include external header files outside <code>C++</code> check</p>
</li>
<li><p>Include external header files with STL C files first followed by application custom files</p>
</li>
<li><p>Header file must include only every other header file in order to compile correctly, but not more (.c should include the rest if required)</p>
</li>
<li><p>Header file must only expose module public variables/types/functions</p>
</li>
<li><p>Use <code>extern</code> for global module variables in header file, define them in source file later</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* file.h ... *&#x2F;</span><br><span class="line">#ifndef ...</span><br><span class="line"></span><br><span class="line">extern int32_t my_variable; &#x2F;* This is global variable declaration in header *&#x2F;</span><br><span class="line"></span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">&#x2F;* file.c ... *&#x2F;</span><br><span class="line">int32_t my_variable;        &#x2F;* Actually defined in source *&#x2F;</span><br></pre></td></tr></table></figure></li>
<li><p>Never include <code>.c</code> files in another <code>.c</code> file</p>
</li>
<li><p><code>.c</code> file should first include corresponding <code>.h</code> file, later others, unless otherwise explicitly necessary</p>
</li>
<li><p>Do not include module private declarations in header file</p>
</li>
<li><p>Header file example (no license for sake of an example)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* License comes here */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> TEMPLATE_HDR_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TEMPLATE_HDR_H</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Include headers */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* File content here */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* TEMPLATE_HDR_H */</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Artistic-style-configuration"><a href="#Artistic-style-configuration" class="headerlink" title="Artistic style configuration"></a>Artistic style configuration</h2></li>
</ul>
<p><a class="link"   target="_blank" rel="noopener" href="http://astyle.sourceforge.net/" >AStyle<i class="fas fa-external-link-alt"></i></a> is a great piece of software that can<br>help with formatting the code based on input configuration.</p>
<p>This repository contains <code>astyle-code-format.cfg</code> file which can be used with <code>AStyle</code> software.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">astyle --options&#x3D;&quot;astyle-code-format.cfg&quot; &quot;input_path&#x2F;*.c,*.h&quot; &quot;input_path2&#x2F;*.c,*.h&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Eclipse-formatter"><a href="#Eclipse-formatter" class="headerlink" title="Eclipse formatter"></a>Eclipse formatter</h2><p>Repository contains <code>eclipse-ext-kr-format.xml</code> file that can be used with<br>eclipse-based toolchains to set formatter options.</p>
<p>It is based on K&amp;R formatter with modifications to respect above rules.<br>You can import it within eclipse settings, <code>Preferences -&gt; LANGUAGE -&gt; Code Style -&gt; Formatter</code> tab.</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：Recommended C style and coding rules</li>
        <li>本文作者：耀眼的大神</li>
        <li>创建时间：2021-01-21 16:26:00</li>
        <li>
            本文链接：https://dazzlingokami.github.io/2021/01/21/Recommended C style and coding rules/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/03/22/Macro%20returning%20the%20number%20of%20arguments%20it%20is%20given%20in%20C/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Macro returning the number of arguments it is given in C?</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2024&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">耀眼的大神</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/code-copy.js"></script>




<div class="post-scripts">
    
</div>



</body>
</html>
