<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="è€€çœ¼çš„å¤§ç¥">
    
    <title>
        
            ä»å•ç‰‡æœºåˆ°FPGAï¼šæˆ‘çš„RISC-Vè½¯æ ¸å¼€å‘å®è·µ |
        
        è€€çœ¼çš„å¤§ç¥
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/blog.svg">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/solid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/brands.min.css">
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"dazzlingokami.github.io","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"è€€çœ¼çš„å¤§ç¥","author":"è€€çœ¼çš„å¤§ç¥","avatar":"/images/face.webp","favicon":"images/blog.svg"},"menu":{"Home":"/","Archives":"/archives","About":"/about"},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"category":false,"tag":false,"announcement":null,"post_datetime":"created"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["åµŒå…¥å¼è½¯ä»¶å·¥ç¨‹å¸ˆ"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":false,"reward":{"enable":false,"img_link":null,"text":null},"img_align":"center"},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":2},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":true,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"record":{"enable":false},"site_deploy":{"enable":false,"provider":"github","url":null}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
            <a class="site-name border-box" href="/">
               è€€çœ¼çš„å¤§ç¥
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                é¦–é¡µ
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                å½’æ¡£
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                å…³äº
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            é¦–é¡µ
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            å½’æ¡£
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                            å…³äº
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        ä»å•ç‰‡æœºåˆ°FPGAï¼šæˆ‘çš„RISC-Vè½¯æ ¸å¼€å‘å®è·µ
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/face.webp">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">WangGaojie</span>
                                
                                    <span class="author-badge">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-05-16 16:16:13</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Fri May 16 2025 22:22:13 GMT+0800">2025-05-16 22:22:13</span>
            </span>
        

        

        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h1 id="ä»å•ç‰‡æœºåˆ°-FPGAï¼šæˆ‘çš„-RISC-V-è½¯æ ¸å¼€å‘å®è·µ"><a href="#ä»å•ç‰‡æœºåˆ°-FPGAï¼šæˆ‘çš„-RISC-V-è½¯æ ¸å¼€å‘å®è·µ" class="headerlink" title="ä»å•ç‰‡æœºåˆ° FPGAï¼šæˆ‘çš„ RISC-V è½¯æ ¸å¼€å‘å®è·µ"></a>ä»å•ç‰‡æœºåˆ° FPGAï¼šæˆ‘çš„ RISC-V è½¯æ ¸å¼€å‘å®è·µ</h1><h2 id="ä¸€ã€å•ç‰‡æœºæ•°æ®å¤„ç†ç“¶é¢ˆå¼•å‘çš„æŠ€æœ¯æ€è€ƒ"><a href="#ä¸€ã€å•ç‰‡æœºæ•°æ®å¤„ç†ç“¶é¢ˆå¼•å‘çš„æŠ€æœ¯æ€è€ƒ" class="headerlink" title="ä¸€ã€å•ç‰‡æœºæ•°æ®å¤„ç†ç“¶é¢ˆå¼•å‘çš„æŠ€æœ¯æ€è€ƒ"></a>ä¸€ã€å•ç‰‡æœºæ•°æ®å¤„ç†ç“¶é¢ˆå¼•å‘çš„æŠ€æœ¯æ€è€ƒ</h2><p>åœ¨è¿‘æœŸçš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘é­é‡äº†ä¸€ä¸ªæ£˜æ‰‹çš„æŠ€æœ¯æŒ‘æˆ˜ï¼šéœ€è¦åœ¨å•ç‰‡æœºç«¯ç›´æ¥å¤„ç† 2.6Msps çš„æ•°æ®é‡ï¼Œè€Œ 500MHz ä¸»é¢‘é™åˆ¶ä¸‹ï¼Œæ¯ä¸ªæ•°æ®çš„å¤„ç†æ—¶é—´ä»…æœ‰ä¸åˆ° 200 ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚ä¼ ç»Ÿæ–¹æ¡ˆä¸­ï¼Œdouble ç±»å‹çš„é«˜ç²¾åº¦è¿ç®—ä¸¥é‡æ¶ˆè€—è®¡ç®—èµ„æºï¼Œæ•°æ®æ€»çº¿å¸¦å®½å‹åŠ›å·¨å¤§ã€‚ç»è¿‡åå¤ä¼˜åŒ–ï¼Œæœ€ç»ˆé€šè¿‡å°†æ•°æ®ç±»å‹æ›¿æ¢ä¸º long å‹ï¼Œå¹¶å€ŸåŠ©æ±‡ç¼–å®ç°éƒ¨åˆ†å¹¶è¡Œå¤„ç†ï¼Œæ‰å‹‰å¼ºæ»¡è¶³å®æ—¶æ€§è¦æ±‚ã€‚</p>
<p>è¿™æ¬¡ç»å†è®©æˆ‘æ·±åˆ»æ„è¯†åˆ°ï¼šå•ç‰‡æœºåœ¨é¢å¯¹å¤§è§„æ¨¡æ•°æ®å¹¶è¡Œè¿ç®—æ—¶å­˜åœ¨å¤©ç„¶å±€é™ã€‚å…¶å†¯ãƒ»è¯ºä¾æ›¼æ¶æ„ä¸‹çš„é¡ºåºæ‰§è¡Œæ¨¡å¼ï¼Œéš¾ä»¥é«˜æ•ˆå¤„ç†é«˜å¯†åº¦è®¡ç®—ä»»åŠ¡ã€‚è€Œ FPGA å‡­å€Ÿç¡¬ä»¶å¹¶è¡Œå¤„ç†çš„ç‰¹æ€§ï¼Œæ˜¾ç„¶æ›´é€‚åˆè¿™ç±»åœºæ™¯ã€‚äºæ˜¯ï¼Œæˆ‘å†³å®šé€šè¿‡ä¸€ä¸ªå®æˆ˜é¡¹ç›®å¼€å¯ FPGA çš„å­¦ä¹ ä¹‹æ—…ï¼Œç›®æ ‡æ˜¯æ„å»º STM32 ä¸ FPGA ååŒå·¥ä½œçš„å¼‚æ„è®¡ç®—ç³»ç»Ÿã€‚</p>
<h2 id="äºŒã€é¡¹ç›®æ¶æ„è®¾è®¡ï¼šæ„å»ºå¼‚æ„è®¡ç®—ç³»ç»Ÿ"><a href="#äºŒã€é¡¹ç›®æ¶æ„è®¾è®¡ï¼šæ„å»ºå¼‚æ„è®¡ç®—ç³»ç»Ÿ" class="headerlink" title="äºŒã€é¡¹ç›®æ¶æ„è®¾è®¡ï¼šæ„å»ºå¼‚æ„è®¡ç®—ç³»ç»Ÿ"></a>äºŒã€é¡¹ç›®æ¶æ„è®¾è®¡ï¼šæ„å»ºå¼‚æ„è®¡ç®—ç³»ç»Ÿ</h2><h3 id="ï¼ˆä¸€ï¼‰æ ¸å¿ƒåŠŸèƒ½å®šä¹‰"><a href="#ï¼ˆä¸€ï¼‰æ ¸å¿ƒåŠŸèƒ½å®šä¹‰" class="headerlink" title="ï¼ˆä¸€ï¼‰æ ¸å¿ƒåŠŸèƒ½å®šä¹‰"></a>ï¼ˆä¸€ï¼‰æ ¸å¿ƒåŠŸèƒ½å®šä¹‰</h3><p>é¡¹ç›®çš„æ ¸å¿ƒç›®æ ‡æ˜¯åœ¨ FPGA å†…è¿è¡Œ RISC-V è½¯æ ¸ï¼Œç”± STM32 é€šè¿‡ FMC æ€»çº¿å®Œæˆç¨‹åºåŠ è½½ä¸è¿è¡Œæ§åˆ¶ï¼Œå¹¶å®ç°ä¸¤è€…çš„æ•°æ®äº¤äº’ã€‚è¿™ä¸€æ¶æ„å€Ÿé‰´äº†å·¥ä¸šæ§åˆ¶ä¸­ â€œARM+FPGAâ€ çš„ç»å…¸ç»„åˆæ¨¡å¼ï¼šSTM32 è´Ÿè´£ä¸Šå±‚é€»è¾‘æ§åˆ¶ï¼ŒFPGA æ‰¿æ‹…åº•å±‚å¹¶è¡Œè®¡ç®—ï¼Œé€šè¿‡å†…å­˜æ˜ å°„çš„ FMC æ€»çº¿å®ç°é«˜æ•ˆé€šè®¯ã€‚</p>
<h3 id="ï¼ˆäºŒï¼‰å…³é”®æŠ€æœ¯é€‰å‹"><a href="#ï¼ˆäºŒï¼‰å…³é”®æŠ€æœ¯é€‰å‹" class="headerlink" title="ï¼ˆäºŒï¼‰å…³é”®æŠ€æœ¯é€‰å‹"></a>ï¼ˆäºŒï¼‰å…³é”®æŠ€æœ¯é€‰å‹</h3><p><strong>RISC-V è½¯æ ¸</strong>ï¼šé€‰æ‹© <a class="link"   target="_blank" rel="noopener" href="https://github.com/YosysHQ/picorv32" >PicoRV32<i class="fas fa-external-link-alt"></i></a> ä½œä¸ºæ ¸å¿ƒï¼Œå› å…¶è½»é‡çº§è®¾è®¡å’Œå¼€æºç”Ÿæ€ï¼Œä¾¿äºå¿«é€Ÿé›†æˆã€‚</p>
<p><strong>ç¡¬ä»¶å¹³å°</strong>ï¼š</p>
<p>FPGA é€‰ç”¨å®‰è·¯ç§‘æŠ€ EF2L45LG144B å¼€å‘æ¿ï¼Œå…¶å†…ç½®çš„ 256KB åŒç«¯å£ ERAM æˆä¸ºå…³é”®ï¼šä¸€ä¸ªç«¯å£è¿æ¥ RISC-V æ ¸ï¼ˆ32 ä½æ•°æ®å®½åº¦ï¼‰ï¼Œå¦ä¸€ä¸ªç«¯å£é€šè¿‡ FMC æ¥å£ä¸ STM32ï¼ˆ16 ä½æ•°æ®å®½åº¦ï¼‰é€šä¿¡ï¼Œæ•°æ®ä½å®½è½¬æ¢é€šè¿‡åœ°å€ä½ä½è‡ªåŠ¨é€‰æ‹©é«˜ä½å­—èŠ‚å®ç°ã€‚</p>
<p>è‡ªä¸»è®¾è®¡ STM32 æ‰©å±•æ¿ï¼Œé€šè¿‡FPGAå¼€å‘æ¿é¢„ç•™æ¥å£ä¸ STM32 å®ç°ç¡¬ä»¶çº§è”ï¼Œæ„å»ºå®Œæ•´çš„åŒæ ¸å¿ƒç³»ç»Ÿã€‚</p>
<h2 id="ä¸‰ã€Verilog-è®¾è®¡å®è·µï¼šä»æ¨¡å—é›†æˆåˆ°æ—¶åºä¼˜åŒ–"><a href="#ä¸‰ã€Verilog-è®¾è®¡å®è·µï¼šä»æ¨¡å—é›†æˆåˆ°æ—¶åºä¼˜åŒ–" class="headerlink" title="ä¸‰ã€Verilog è®¾è®¡å®è·µï¼šä»æ¨¡å—é›†æˆåˆ°æ—¶åºä¼˜åŒ–"></a>ä¸‰ã€Verilog è®¾è®¡å®è·µï¼šä»æ¨¡å—é›†æˆåˆ°æ—¶åºä¼˜åŒ–</h2><h3 id="ï¼ˆä¸€ï¼‰é¡¶å±‚æ¶æ„è®¾è®¡"><a href="#ï¼ˆä¸€ï¼‰é¡¶å±‚æ¶æ„è®¾è®¡" class="headerlink" title="ï¼ˆä¸€ï¼‰é¡¶å±‚æ¶æ„è®¾è®¡"></a>ï¼ˆä¸€ï¼‰é¡¶å±‚æ¶æ„è®¾è®¡</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span>  1 ps / 1 ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> top(</span><br><span class="line">    <span class="keyword">input</span> clk_ref,</span><br><span class="line">    <span class="keyword">input</span> i_rst,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">inout</span> [<span class="number">15</span>:<span class="number">0</span>] fmc_data,</span><br><span class="line">    <span class="keyword">input</span> fmc_wrn,</span><br><span class="line">    <span class="keyword">input</span> fmc_rdn,</span><br><span class="line">    <span class="keyword">input</span> fmc_csn,</span><br><span class="line">    <span class="keyword">input</span> fmc_nadv</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> clk;</span><br><span class="line">    <span class="keyword">wire</span> rstn;</span><br><span class="line"></span><br><span class="line">    sys_clk u_sys_clk(</span><br><span class="line">        <span class="variable">.clk_ref</span>(clk_ref),</span><br><span class="line">        <span class="variable">.i_rst</span>(i_rst),</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rstn</span>(rstn)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] mem_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] mem_wdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] mem_rdata;</span><br><span class="line">    <span class="keyword">wire</span> mem_wen;</span><br><span class="line">    <span class="keyword">wire</span> mem_do;</span><br><span class="line">    fmc_bus u_fmc_bus (</span><br><span class="line">        <span class="variable">.sys_clk</span>(clk),</span><br><span class="line">        <span class="variable">.sys_rst_n</span>(rstn),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.db</span>(fmc_data),</span><br><span class="line">        <span class="variable">.wrn</span>(fmc_wrn),</span><br><span class="line">        <span class="variable">.rdn</span>(fmc_rdn),</span><br><span class="line">        <span class="variable">.csn</span>(fmc_csn),</span><br><span class="line">        <span class="variable">.nadv</span>(fmc_nadv),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.ram_addr</span>(mem_addr),</span><br><span class="line">        <span class="variable">.ram_wdata</span>(mem_wdata),</span><br><span class="line">        <span class="variable">.ram_rdata</span>(mem_rdata),</span><br><span class="line">        <span class="variable">.ram_wen</span>(mem_wen),</span><br><span class="line">        <span class="variable">.ram_do</span>(mem_do)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> sram_valid;</span><br><span class="line">    <span class="keyword">assign</span> sram_valid = (mem_addr &lt; <span class="number">16&#x27;h8000</span>);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] sram_rdata;</span><br><span class="line">    picorv32_ctrl u_picorv32_ctrl(</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.rstn</span>(rstn),</span><br><span class="line">        <span class="variable">.ram_addr</span>(mem_addr),</span><br><span class="line">        <span class="variable">.ram_wdata</span>(mem_wdata),</span><br><span class="line">        <span class="variable">.ram_wen</span>(mem_wen),</span><br><span class="line">        <span class="variable">.ram_rdata</span>(sram_rdata),</span><br><span class="line">        <span class="variable">.ram_do</span>(mem_do &amp; sram_valid)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> mem_rdata =     sram_valid ? sram_rdata :</span><br><span class="line">                        <span class="number">16&#x27;h0000</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>é¡¶å±‚æ¨¡å—é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼š</p>
<p><strong>æ—¶é’Ÿå­ç³»ç»Ÿ</strong>ï¼šé€šè¿‡ FPGA å†…ç½® PLL ç”Ÿæˆ 100MHz ç¨³å®šæ—¶é’Ÿï¼Œæ»¡è¶³ RISC-V æ ¸ä¸ FMC æ€»çº¿çš„æ—¶åºè¦æ±‚ã€‚</p>
<p><strong>æ€»çº¿æ¥å£å±‚</strong>ï¼šFMC æ¨¡å—å®ç°å¼‚æ­¥æ€»çº¿åè®®è½¬æ¢ï¼Œå°† STM32 çš„ 16 ä½ FMC ä¿¡å·æ˜ å°„ä¸º 16 ä½å†…å­˜æ¥å£ï¼Œåœ°å€ç©ºé—´åˆ’åˆ†ä¸ºå‰ 64KBï¼ˆRISC-V ç¨‹åºåŒºï¼‰å’Œæ‰©å±•åŒºï¼ˆé¢„ç•™æœªæ¥åŠŸèƒ½ï¼‰ã€‚</p>
<p><strong>æ ¸å¿ƒæ§åˆ¶å±‚</strong>ï¼šPicoRV32_CTRL æ¨¡å—è´Ÿè´£è½¯æ ¸ä¸å†…å­˜çš„äº¤äº’ï¼Œé€šè¿‡åŒç«¯å£ RAM å®ç° STM32ï¼ˆç«¯å£ Bï¼‰ä¸ RISC-Vï¼ˆç«¯å£ Aï¼‰çš„å¹¶è¡Œè®¿é—®ã€‚</p>
<h3 id="ï¼ˆäºŒï¼‰RV32æ ¸å¿ƒæ§åˆ¶"><a href="#ï¼ˆäºŒï¼‰RV32æ ¸å¿ƒæ§åˆ¶" class="headerlink" title="ï¼ˆäºŒï¼‰RV32æ ¸å¿ƒæ§åˆ¶"></a>ï¼ˆäºŒï¼‰RV32æ ¸å¿ƒæ§åˆ¶</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> picorv32_ctrl(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> rstn,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] ram_addr,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] ram_wdata,</span><br><span class="line">    <span class="keyword">input</span> ram_wen,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">15</span>:<span class="number">0</span>] ram_rdata,</span><br><span class="line">    <span class="keyword">input</span> ram_do</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> trap;</span><br><span class="line">    <span class="keyword">wire</span> mem_valid;</span><br><span class="line">    <span class="keyword">wire</span> mem_instr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> mem_ready;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>]    mem_rdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] mem_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] mem_wdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] mem_wstrb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> mem_la_read;</span><br><span class="line">    <span class="keyword">wire</span> mem_la_write;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] mem_la_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] mem_la_wdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] mem_la_wstrb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> rv32_rstn;</span><br><span class="line">    <span class="keyword">reg</span> rv32_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>] rv32_ctrl_out;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(~rstn) <span class="keyword">begin</span></span><br><span class="line">            rv32_rstn &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            rv32_rstn &lt;= rv32_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">if</span>(~rstn) <span class="keyword">begin</span></span><br><span class="line">            rv32_state &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(ram_do) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(ram_addr)</span><br><span class="line">                <span class="number">16&#x27;h4001</span>: <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span>(ram_wen)</span><br><span class="line">                        rv32_state = ram_wdata[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        rv32_ctrl_out &lt;= &#123;<span class="number">15&#x27;b0</span>, rv32_state&#125;;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                    rv32_ctrl_out &lt;= <span class="number">16&#x27;h0000</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    picorv32 <span class="variable">#(.COMPRESSED_ISA(1))</span></span><br><span class="line">    picorv32_core (</span><br><span class="line">        <span class="variable">.clk</span>         (clk         ),</span><br><span class="line">        <span class="variable">.resetn</span>      (rv32_rstn   ),</span><br><span class="line">        <span class="variable">.trap</span>        (trap        ),</span><br><span class="line">        <span class="variable">.mem_valid</span>   (mem_valid   ),</span><br><span class="line">        <span class="variable">.mem_instr</span>   (mem_instr   ),</span><br><span class="line">        <span class="variable">.mem_ready</span>   (mem_ready   ),</span><br><span class="line">        <span class="variable">.mem_addr</span>    (mem_addr    ),</span><br><span class="line">        <span class="variable">.mem_wdata</span>   (mem_wdata   ),</span><br><span class="line">        <span class="variable">.mem_wstrb</span>   (mem_wstrb   ),</span><br><span class="line">        <span class="variable">.mem_rdata</span>   (mem_rdata   ),</span><br><span class="line">        <span class="variable">.mem_la_read</span> (mem_la_read ),</span><br><span class="line">        <span class="variable">.mem_la_write</span>(mem_la_write),</span><br><span class="line">        <span class="variable">.mem_la_addr</span> (mem_la_addr ),</span><br><span class="line">        <span class="variable">.mem_la_wdata</span>(mem_la_wdata),</span><br><span class="line">        <span class="variable">.mem_la_wstrb</span>(mem_la_wstrb)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ram_32_rdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] ram_32_wdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] ram_byte_en;</span><br><span class="line">    <span class="keyword">assign</span> ram_byte_en = ram_addr[<span class="number">0</span>] == <span class="number">1&#x27;b0</span> ? <span class="number">4&#x27;b0011</span> : <span class="number">4&#x27;b1100</span>;</span><br><span class="line">    <span class="keyword">assign</span> ram_32_wdata = &#123;ram_wdata, ram_wdata&#125;;</span><br><span class="line">    <span class="keyword">assign</span> ram_rdata = (ram_addr[<span class="number">0</span>] == <span class="number">1&#x27;b0</span> &amp;&amp; ram_addr[<span class="number">15</span>:<span class="number">14</span>] == <span class="number">0</span>) ? ram_32_rdata[<span class="number">15</span>:<span class="number">0</span>] :</span><br><span class="line">                       (ram_addr[<span class="number">0</span>] == <span class="number">1&#x27;b1</span> &amp;&amp; ram_addr[<span class="number">15</span>:<span class="number">14</span>] == <span class="number">0</span>) ? ram_32_rdata[<span class="number">31</span>:<span class="number">16</span>] :</span><br><span class="line">                       rv32_ctrl_out;</span><br><span class="line">    EF2_BRAM256 u_EF2_BRAM256(</span><br><span class="line">        <span class="variable">.doa</span>(ram_32_rdata),</span><br><span class="line">        <span class="variable">.dia</span>(ram_32_wdata),</span><br><span class="line">        <span class="variable">.cea</span>(ram_do &amp; ram_addr[<span class="number">15</span>:<span class="number">14</span>] == <span class="number">0</span>),</span><br><span class="line">        <span class="variable">.clka</span>(clk),</span><br><span class="line">        <span class="variable">.wea</span>(ram_wen),</span><br><span class="line">        <span class="variable">.rsta</span>(~rstn),</span><br><span class="line">        <span class="variable">.addra</span>(ram_addr[<span class="number">13</span>:<span class="number">1</span>]),</span><br><span class="line">        <span class="variable">.weabyte</span>(ram_byte_en),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.dob</span>(mem_rdata),</span><br><span class="line">        <span class="variable">.dib</span>(mem_la_wdata),</span><br><span class="line">        <span class="variable">.ceb</span>(<span class="number">1&#x27;b1</span>),</span><br><span class="line">        <span class="variable">.clkb</span>(clk),</span><br><span class="line">        <span class="variable">.web</span>(mem_la_write),</span><br><span class="line">        <span class="variable">.rstb</span>(~rstn),</span><br><span class="line">        <span class="variable">.addrb</span>(mem_la_addr[<span class="number">14</span>:<span class="number">2</span>]),</span><br><span class="line">        <span class="variable">.webbyte</span>(mem_la_wstrb)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~rstn) <span class="keyword">begin</span></span><br><span class="line">            mem_ready &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            mem_ready &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>æ¨¡å—å†…ä¾‹åŒ–äº†ä¸¤ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«æ˜¯rv32å†…æ ¸æ¨¡å—å’ŒBRAMæ¨¡å—ã€‚picorv32æ¨¡å—é€šè¿‡ä¸€ä¸ªç®€å•çš„å†…å­˜é¢„å–æ¥å£å°†å…¶è¿æ¥åˆ°32kå­—èŠ‚çš„å†…å­˜å—ã€‚picorv32_ctrlæä¾›çš„æ•´ä¸ªåœ°å€ç©ºé—´ï¼Œå‰é¢32kbç›´è¿BRAMå†…å­˜å—ï¼Œåé¢32kbè¿æ¥å†…éƒ¨å®ç°çš„å¯„å­˜å™¨ï¼Œç›®å‰å¯„å­˜å™¨åªæœ‰ä¸€ä¸ªï¼Œç”¨äºæ§åˆ¶rv32å†…æ ¸çš„å¤ä½çŠ¶æ€æ¥æ§åˆ¶å†…æ ¸çš„è¿è¡Œã€‚</p>
<p>BRAMçš„å†…å­˜å®½åº¦æ˜¯32bitï¼Œå‰é¢FMCçš„å†…å­˜å®½åº¦æ˜¯16bitï¼Œæ‰€æœ‰è¿™é‡Œåšäº†ä¸€ä¸ªå·§å¦™çš„å¤„ç†ï¼Œé€šè¿‡åœ°å€ä½ä½æ¥é€‰æ‹©è¾“å…¥è¾“å‡ºæ•°æ®çš„é«˜ä½è¿˜æ˜¯ä½ä½ã€‚</p>
<p>picorv32é»˜è®¤æ²¡æœ‰å¼€å¯æŒ‡ä»¤å‹ç¼©å’Œä¹˜æ³•æ‰©å±•ï¼Œè¿™é‡Œé€šè¿‡COMPRESSED_ISAæ‰‹åŠ¨æ‰“å¼€æŒ‡ä»¤å‹ç¼©ã€‚ä¸ºäº†èŠ‚çœä¸€ç‚¹LUTèµ„æºå°±ä¸å¼€ä¹˜æ³•æ‰©å±•äº†ã€‚åœ¨é€šè¿‡riscv-gccç¼–è¯‘ç¨‹åºæ—¶çš„æ¶æ„é€‰å‹åº”ä¸º-march&#x3D;rv32icã€‚</p>
<h3 id="ï¼ˆä¸‰ï¼‰FMCå¼‚æ­¥æ¥å£"><a href="#ï¼ˆä¸‰ï¼‰FMCå¼‚æ­¥æ¥å£" class="headerlink" title="ï¼ˆä¸‰ï¼‰FMCå¼‚æ­¥æ¥å£"></a>ï¼ˆä¸‰ï¼‰FMCå¼‚æ­¥æ¥å£</h3><p>è¿™ä¸ªæ¥å£ä»£ç åº”è¯¥æ˜¯ä¸å¤æ‚çš„ï¼Œä½†æˆ‘å‘ç°æˆ‘å†™çš„ä»£ç çœ‹ç€å¾ˆåˆ«æ‰­ï¼Œä»£ç è´¨é‡ä¸é«˜ï¼Œæ‰€ä»¥å°±ä¸å±•ç¤ºäº†ã€‚ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>
<h2 id="å››ã€è½¯ä»¶ç”Ÿæ€æ„å»ºï¼šä»ç¼–è¯‘é“¾åˆ°æ§åˆ¶ç¨‹åº"><a href="#å››ã€è½¯ä»¶ç”Ÿæ€æ„å»ºï¼šä»ç¼–è¯‘é“¾åˆ°æ§åˆ¶ç¨‹åº" class="headerlink" title="å››ã€è½¯ä»¶ç”Ÿæ€æ„å»ºï¼šä»ç¼–è¯‘é“¾åˆ°æ§åˆ¶ç¨‹åº"></a>å››ã€è½¯ä»¶ç”Ÿæ€æ„å»ºï¼šä»ç¼–è¯‘é“¾åˆ°æ§åˆ¶ç¨‹åº</h2><h3 id="ï¼ˆä¸€ï¼‰RISC-V-æµ‹è¯•ç¨‹åºå¼€å‘"><a href="#ï¼ˆä¸€ï¼‰RISC-V-æµ‹è¯•ç¨‹åºå¼€å‘" class="headerlink" title="ï¼ˆä¸€ï¼‰RISC-V æµ‹è¯•ç¨‹åºå¼€å‘"></a>ï¼ˆä¸€ï¼‰RISC-V æµ‹è¯•ç¨‹åºå¼€å‘</h3><p>é‡‡ç”¨ MounRiver Studio å¼€å‘å·¥å…·ä¸­é›†æˆçš„ RISC-V å·¥å…·é“¾ï¼Œç¼–å†™åŒ…å«è§£å¯†åŠŸèƒ½çš„æµ‹è¯•ç¨‹åºï¼š</p>
<p><strong>å¯åŠ¨æ±‡ç¼–ï¼ˆstart.Sï¼‰</strong>ï¼šåˆå§‹åŒ–æ ˆæŒ‡é’ˆåˆ° 1KB åœ°å€å¤„ï¼Œå»ºç«‹ç¨‹åºè¿è¡Œçš„åŸºæœ¬ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.section .init</span><br><span class="line">.global main</span><br><span class="line">lui sp, %hi(0x00001000)       // åŠ è½½æ ˆåŸºå€é«˜12ä½</span><br><span class="line">addi sp, sp, %lo(0x00001000)  // ç”Ÿæˆå®Œæ•´32ä½åœ°å€</span><br><span class="line">jal ra, main                  // è°ƒç”¨Cä¸»å‡½æ•°</span><br><span class="line">ebreak                        // ç¨‹åºç»“æŸ</span><br></pre></td></tr></table></figure>

<p><strong>C è¯­è¨€é€»è¾‘</strong>ï¼šå®ç° ROT13 è§£å¯†ç®—æ³•ï¼Œå°†æ··æ·†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯è¯»ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="type">char</span> *pmem = (<span class="type">void</span>*)<span class="number">0x1000</span>;     <span class="comment">// å®šä¹‰è¾“å‡ºç¼“å†²åŒº</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">putc</span><span class="params">(<span class="type">char</span> c)</span></span><br><span class="line">&#123;</span><br><span class="line">    *pmem++ = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">puts</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *s)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> j;</span><br><span class="line">    <span class="keyword">while</span> (*s)</span><br><span class="line">    &#123;</span><br><span class="line">        putc(*s++);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">memcpy</span><span class="params">(<span class="type">void</span> *dest, <span class="type">const</span> <span class="type">void</span> *src, <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">while</span> (n) </span><br><span class="line">	&#123;</span><br><span class="line">		n--;</span><br><span class="line">		((<span class="type">char</span>*)dest)[n] = ((<span class="type">char</span>*)src)[n];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¾…è§£å¯†çš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">char</span> message[] = <span class="string">&quot;$Uryyb+Jbeyq!+Vs+lbh+pna+ernq+guvf+zrffntr+gura$gur+CvpbEI32+PCH&quot;</span></span><br><span class="line">            <span class="string">&quot;+frrzf+gb+or+jbexvat+whfg+svar.$$++++++++++++++++GRFG+CNFFRQ!$$&quot;</span>;</span><br><span class="line">    <span class="comment">// ROT13è§£å¯†é€»è¾‘</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; message[i]; i++)</span><br><span class="line">        <span class="keyword">switch</span> (message[i])</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span> ... <span class="string">&#x27;m&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span> ... <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">            message[i] += <span class="number">13</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;n&#x27;</span> ... <span class="string">&#x27;z&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;N&#x27;</span> ... <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            message[i] -= <span class="number">13</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;$&#x27;</span>:</span><br><span class="line">            message[i] = <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">            message[i] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºè§£å¯†åçš„æ•°æ®</span></span><br><span class="line">    <span class="built_in">puts</span>(message);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å†…å­˜é“¾æ¥è„šæœ¬ï¼ˆfirmware.ldsï¼‰</strong>ï¼šå®šä¹‰ 32KB ç»Ÿä¸€ç¼–å€ç©ºé—´ï¼Œæ•´åˆä»£ç ä¸æ•°æ®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MEMORY &#123;</span><br><span class="line">    mem : ORIGIN = 0x00000000, LENGTH = 0x8000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SECTIONS &#123;</span><br><span class="line">    .memory : &#123;</span><br><span class="line">        . = 0x000000;</span><br><span class="line">        start*(.text);</span><br><span class="line">        *(.init);</span><br><span class="line">        *(.text);</span><br><span class="line">        *(*);</span><br><span class="line">        end = .;</span><br><span class="line">        . = ALIGN(4);</span><br><span class="line">    &#125; &gt; mem</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆäºŒï¼‰STM32-æ§åˆ¶ç¨‹åºå®ç°"><a href="#ï¼ˆäºŒï¼‰STM32-æ§åˆ¶ç¨‹åºå®ç°" class="headerlink" title="ï¼ˆäºŒï¼‰STM32 æ§åˆ¶ç¨‹åºå®ç°"></a>ï¼ˆäºŒï¼‰STM32 æ§åˆ¶ç¨‹åºå®ç°</h3><p>é€šè¿‡ FMC æ€»çº¿å®ç°å›ºä»¶åŠ è½½ä¸çŠ¶æ€æ§åˆ¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;incfile.h&quot;</span></span></span><br><span class="line">INCFILE(fw, <span class="string">&quot;main.bin&quot;</span>);    <span class="comment">// åµŒå…¥äºŒè¿›åˆ¶å›ºä»¶</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* MCU Configuration--------------------------------------------------------*/</span></span><br><span class="line">  MPU_Region_InitTypeDef MPU_InitStruct = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Disables the MPU */</span></span><br><span class="line">  HAL_MPU_Disable();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure the MPU attributes for the FMC */</span></span><br><span class="line">  MPU_InitStruct.Enable           = MPU_REGION_ENABLE;</span><br><span class="line">  MPU_InitStruct.Number           = MPU_REGION_NUMBER0;</span><br><span class="line">  MPU_InitStruct.BaseAddress      = <span class="number">0x60000000</span>;</span><br><span class="line">  MPU_InitStruct.Size             = MPU_REGION_SIZE_256MB;</span><br><span class="line">  MPU_InitStruct.AccessPermission = MPU_REGION_FULL_ACCESS;</span><br><span class="line">  MPU_InitStruct.IsBufferable     = MPU_ACCESS_NOT_BUFFERABLE;</span><br><span class="line">  MPU_InitStruct.IsCacheable      = MPU_ACCESS_NOT_CACHEABLE;</span><br><span class="line">  MPU_InitStruct.IsShareable      = MPU_ACCESS_NOT_SHAREABLE;</span><br><span class="line">  MPU_InitStruct.DisableExec      = MPU_INSTRUCTION_ACCESS_DISABLE;</span><br><span class="line">  MPU_InitStruct.TypeExtField     = MPU_TEX_LEVEL0;</span><br><span class="line">  MPU_InitStruct.SubRegionDisable = <span class="number">0x00</span>;</span><br><span class="line">  HAL_MPU_ConfigRegion(&amp;MPU_InitStruct);</span><br><span class="line">  HAL_MPU_Enable(MPU_PRIVILEGED_DEFAULT);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span></span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure the system clock */</span></span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize all configured peripherals */</span></span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  MX_FMC_Init();        <span class="comment">// åˆå§‹åŒ–FMCæ€»çº¿</span></span><br><span class="line">  MX_USART1_UART_Init();<span class="comment">// åˆå§‹åŒ–è¾“å‡ºä¸²å£</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SRAM_ADDR (0x60000000)</span></span><br><span class="line">  HAL_Delay(<span class="number">1000</span>);      <span class="comment">// ç­‰å¾…FPGAç¨‹åºä¸Šç”µå¤ä½å®Œæˆ</span></span><br><span class="line">  <span class="type">uint16_t</span> *addr = (<span class="type">void</span>*)SRAM_ADDR;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æµ‹è¯•FMCå†…å­˜è¯»å†™</span></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i++)&#123;</span><br><span class="line">      addr[i] = i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i++)&#123;</span><br><span class="line">      <span class="keyword">if</span>(addr[i] != i)&#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;sram error %d %d\r\n&quot;</span>, i, addr[i]);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;sram check complate\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åŠ è½½å›ºä»¶åˆ°FPGA</span></span><br><span class="line">  <span class="type">const</span> <span class="type">uint16_t</span> *fw = FILEPTR(fw);</span><br><span class="line">  <span class="type">int</span> fw_size = FILESIZE(fw);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; fw_size/<span class="number">2</span>+<span class="number">1</span>; i++)&#123;</span><br><span class="line">      addr[i] = fw[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;firmware load complate\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ§åˆ¶RISC-Vè¿è¡Œ</span></span><br><span class="line">  <span class="type">uint16_t</span> *run_enable = (<span class="type">uint16_t</span>*)(<span class="number">0x60000000</span> + (<span class="number">0x4001</span> &lt;&lt; <span class="number">1</span>));</span><br><span class="line">  *run_enable = <span class="number">1</span>; <span class="comment">// å†™å…¥1å¯åŠ¨è½¯æ ¸</span></span><br><span class="line">  HAL_Delay(<span class="number">1000</span>);</span><br><span class="line">  *run_enable = <span class="number">0</span>; <span class="comment">// å†™å…¥0æš‚åœè½¯æ ¸</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯»å–å¹¶æ˜¾ç¤ºç»“æœ</span></span><br><span class="line">  <span class="type">const</span> <span class="type">uint16_t</span> *msg = (<span class="type">uint16_t</span>*)(<span class="number">0x60000000</span> + (<span class="number">0x1000</span>));</span><br><span class="line">  <span class="type">uint16_t</span> buf[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++)&#123;</span><br><span class="line">      buf[i] = msg[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *msg_str = (<span class="type">void</span>*)buf;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\r\n%s\r\n&quot;</span>, msg_str);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">      HAL_Delay(<span class="number">500</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;hello world\r\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¨‹åºé€šè¿‡å†…å­˜æ˜ å°„æ–¹å¼å°† FPGA çš„ ERAM è§†ä¸º STM32 çš„å¤–éƒ¨ SRAMï¼Œç›´æ¥é€šè¿‡æŒ‡é’ˆæ“ä½œå®ç°æ•°æ®äº¤äº’ã€‚æ§åˆ¶å¯„å­˜å™¨ï¼ˆ0x4001ï¼‰çš„å•ä¸ª bit å³å¯å¯åŠ¨ &#x2F; åœæ­¢ RISC-V æ ¸ï¼Œä½“ç°äº†å†…å­˜æ˜ å°„æ¥å£çš„ç®€æ´æ€§ã€‚</p>
<h2 id="äº”ã€è°ƒè¯•è¿‡ç¨‹ä¸å…³é”®éªŒè¯"><a href="#äº”ã€è°ƒè¯•è¿‡ç¨‹ä¸å…³é”®éªŒè¯" class="headerlink" title="äº”ã€è°ƒè¯•è¿‡ç¨‹ä¸å…³é”®éªŒè¯"></a>äº”ã€è°ƒè¯•è¿‡ç¨‹ä¸å…³é”®éªŒè¯</h2><h3 id="ï¼ˆä¸€ï¼‰æ—¶åºçº¦æŸè¦ç‚¹"><a href="#ï¼ˆä¸€ï¼‰æ—¶åºçº¦æŸè¦ç‚¹" class="headerlink" title="ï¼ˆä¸€ï¼‰æ—¶åºçº¦æŸè¦ç‚¹"></a>ï¼ˆä¸€ï¼‰æ—¶åºçº¦æŸè¦ç‚¹</h3><p><strong>æ—¶é’Ÿé…ç½®</strong>ï¼šå¯¹ PLL ç”Ÿæˆçš„ 100MHz æ—¶é’Ÿè¿›è¡Œæ—¶åºçº¦æŸï¼Œç¡®ä¿æ—¶é’ŸæŠ–åŠ¨å°äº 500ps</p>
<p><strong>å¼‚æ­¥æ¥å£</strong>ï¼šåœ¨ FMC æ¨¡å—ä¸­ä½¿ç”¨å¯„å­˜å™¨æ‰“æ‹å¤„ç†å¼‚æ­¥ä¿¡å·ï¼Œé¿å…äºšç¨³æ€é—®é¢˜</p>
<h3 id="ï¼ˆäºŒï¼‰æµ‹è¯•ç»“æœéªŒè¯"><a href="#ï¼ˆäºŒï¼‰æµ‹è¯•ç»“æœéªŒè¯" class="headerlink" title="ï¼ˆäºŒï¼‰æµ‹è¯•ç»“æœéªŒè¯"></a>ï¼ˆäºŒï¼‰æµ‹è¯•ç»“æœéªŒè¯</h3><p>å½“ STM32 å®Œæˆå›ºä»¶åŠ è½½å¹¶å¯åŠ¨ RISC-V æ ¸åï¼Œä¸²å£ç»ˆç«¯æ˜¾ç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sram check complate</span><br><span class="line">firmware load complate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Hello World! If you can read this message then</span><br><span class="line">the PicoRV32 CPU seems to be working just fine.</span><br><span class="line"></span><br><span class="line">                TEST PASSED!</span><br></pre></td></tr></table></figure>

<p>è¿™è¡¨æ˜ï¼š</p>
<ul>
<li>FMC æ€»çº¿é€šè®¯æ­£å¸¸ï¼Œæ•°æ®è¯»å†™æ— è¯¯</li>
<li>RISC-V è½¯æ ¸æ­£ç¡®æ‰§è¡Œäº† ROT13 è§£å¯†ç®—æ³•</li>
<li>åŒæ ¸å¿ƒç³»ç»Ÿçš„ååŒæ§åˆ¶æœºåˆ¶æœ‰æ•ˆ</li>
</ul>
<h3 id="ï¼ˆä¸‰ï¼‰å­¦ä¹ RISC-Væ±‡ç¼–"><a href="#ï¼ˆä¸‰ï¼‰å­¦ä¹ RISC-Væ±‡ç¼–" class="headerlink" title="ï¼ˆä¸‰ï¼‰å­¦ä¹ RISC-Væ±‡ç¼–"></a>ï¼ˆä¸‰ï¼‰å­¦ä¹ RISC-Væ±‡ç¼–</h3><p>æ‰€æœ‰éƒ½æ­£ç¡®æ‰§è¡Œåï¼Œå†å›è¿‡å¤´çœ‹çœ‹RISC-Væµ‹è¯•ç¨‹åºçš„åæ±‡ç¼–ä»£ç ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å› ä¸ºç¼–è¯‘ä¼˜åŒ–è€Œå­˜åœ¨ç¨‹åºè¿è¡Œä½œå¼Šçš„æƒ…å†µã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">00000000 &lt;init&gt;:</span><br><span class="line">   0:   00000137                lui     sp,0x0</span><br><span class="line">   4:   40010113                addi    sp,sp,1024 # 400 &lt;end+0x233&gt;</span><br><span class="line">   8:   0cc000ef                jal     ra,d4 &lt;main&gt;</span><br><span class="line">   c:   9002                    ebreak</span><br><span class="line"></span><br><span class="line">0000000e &lt;putc&gt;:</span><br><span class="line">   e:   15802783                lw      a5,344(zero) # 158 &lt;pmem&gt;</span><br><span class="line">  12:   00178693                addi    a3,a5,1</span><br><span class="line">  16:   14d02c23                sw      a3,344(zero) # 158 &lt;pmem&gt;</span><br><span class="line">  1a:   00a78023                sb      a0,0(a5)</span><br><span class="line">  1e:   8082                    ret</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">000000d4 &lt;main&gt;:</span><br><span class="line">  d4:   7175                    addi    sp,sp,-144</span><br><span class="line">  d6:   08000613                li      a2,128</span><br><span class="line">  da:   05400593                li      a1,84</span><br><span class="line">  de:   850a                    mv      a0,sp</span><br><span class="line">  e0:   c706                    sw      ra,140(sp)</span><br><span class="line">  e2:   3fa9                    jal     3c &lt;memcpy&gt;</span><br><span class="line">  e4:   870a                    mv      a4,sp</span><br><span class="line">  e6:   04d00593                li      a1,77</span><br><span class="line">...</span><br><span class="line">00000158 &lt;pmem&gt;:</span><br><span class="line"> 158:   1000</span><br></pre></td></tr></table></figure>

<p>çœ‹çœ‹putcå‡½æ•°çš„è¡Œä¸ºï¼Œä»0x158åœ°å€å–å‡ºæ•°ä¿å­˜åˆ°a5å¯„å­˜å™¨ï¼Œa5å¯„å­˜å™¨åŠ 1åä¿å­˜åˆ°a3å¯„å­˜å™¨ï¼Œå†å°†a3å¯„å­˜å™¨çš„å€¼å†™å›åˆ°0x158åœ°å€å¤„ã€‚æœ€åå°†a0å¯„å­˜å™¨çš„å€¼å†™å…¥a5åœ°å€ä¸‹å®ç°æ•°æ®è¾“å‡ºã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°0x158åœ°å€ä¸‹çš„åˆå€¼å°±æ˜¯0x1000ï¼Œä¹Ÿå°±æ˜¯pmemå˜é‡çš„åˆå€¼ã€‚åŠŸèƒ½åŒCè¯­è¨€æè¿°çš„ä¸€è‡´ï¼ŒåŒæ—¶ä¹Ÿè¡¨æ˜ä»£ç å’Œæ•°æ®ä¸ºç»Ÿä¸€ç¼–å€ï¼Œæ²¡æœ‰åŒºåˆ†RAMå’ŒROMã€‚å¦‚æœè¦åŒºåˆ†ROMå’ŒRAMï¼Œéœ€è¦æ·»åŠ ä¸€äº›å¯åŠ¨ä»£ç æ¥å¤„ç†dataæ®µæ•°æ®çš„æ‹·è´ã€‚</p>
<p>å‰é¢RISC-Vçš„Cä»£ç ä¸­æœ‰ä¸€ä¸ªmemcpyå‡½æ•°ä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰ï¼Œä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿå¦‚æœå°†è¿™ä¸ªå‡½æ•°åˆ é™¤æ‰ï¼Œç¡®å®ä¼šå¯¼è‡´æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚é€šè¿‡æ£€æŸ¥æ±‡ç¼–æ‰å‘ç°mainå‡½æ•°ç¡®å®ä¼šè°ƒç”¨memcpyï¼Œæ ¹æ®æ±‡ç¼–ä»£ç å’Œmapæ–‡ä»¶ï¼Œmainå‡½æ•°çš„é€»è¾‘æ˜¯åŸé™æ€å­—ç¬¦ä¸²å­˜å‚¨åœ¨rodataåŒºï¼Œç„¶ååœ¨æ ˆä¸Šåˆ†é…äº†ä¸€æ®µå†…å­˜æ¥ä¿å­˜messageæ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦memcpyæ¥å¤„ç†ä¸€å¤§æ®µå†…å­˜çš„æ‹·è´ã€‚è¿™ä¹Ÿæ˜¯åŒARMæ±‡ç¼–ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå­¦çš„æ–°çŸ¥è¯†äº†ğŸ˜„</p>
<h3 id="ï¼ˆå››ï¼‰è§‚å¯ŸRISC-Vçš„è¿è¡Œ"><a href="#ï¼ˆå››ï¼‰è§‚å¯ŸRISC-Vçš„è¿è¡Œ" class="headerlink" title="ï¼ˆå››ï¼‰è§‚å¯ŸRISC-Vçš„è¿è¡Œ"></a>ï¼ˆå››ï¼‰è§‚å¯ŸRISC-Vçš„è¿è¡Œ</h3><p>é€šè¿‡FPGAå¼€å‘å·¥å…·æä¾›çš„èŠ¯ç‰‡è°ƒè¯•å·¥å…·ï¼Œå¯ä»¥å»æ•è·è§‚æµ‹FPGAè¿è¡Œè¿‡ç¨‹ä¸­å¯„å­˜å™¨çš„å€¼ã€‚é€šè¿‡è§‚æµ‹reg_pcå’Œmem_rdataï¼Œæ›´åŠ ç›´è§‚çš„çœ‹åˆ°RISC-Vçš„è¿è¡Œè¿‡ç¨‹å’Œå†…å­˜å–å€¼çš„è¿‡ç¨‹ã€‚å‘ç°æ¯ä¸ªæŒ‡ä»¤æ‰§è¡Œçš„å‘¨æœŸä¸º1~7ä¸ªæ—¶é’Ÿå‘¨æœŸä¸ç­‰ã€‚jalè·³è½¬æŒ‡ä»¤æ‰§è¡Œæœ€å¿«ï¼Œä»…éœ€1ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å†…å­˜è¯»å†™æŒ‡ä»¤(sw)ã€æ¡ä»¶è·³è½¬(bnez)ã€åŠ æ³•(addi)æŒ‡ä»¤ç­‰éœ€è¦5ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚</p>
<h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>å›é¡¾å¼€å‘è¿‡ç¨‹ï¼Œå­¦ä¼šäº†Verilogæ¨¡å—åŒ–è®¾è®¡çš„åŸºæœ¬æ–¹æ³•ï¼Œå°¤å…¶æ˜¯å†…å­˜æ¥å£çš„åº”ç”¨ã€‚æ­¤å¤–è¿˜å¢å¼ºäº†å¯¹RISC-Vçš„äº†è§£ï¼Œå®ç°äº†ä»æºç ã€å·¥å…·é“¾å†åˆ°ç¡¬ä»¶æ‰§è¡Œçš„å®Œæ•´æµç¨‹ã€‚</p>
<p>å›å¿†èµ·æˆ‘åˆšæ¯•ä¸šå‚åŠ å·¥ä½œï¼Œé‚£æ—¶å…¬å¸ç ”å‘çš„é¡¹ç›®åŸºæœ¬ä¸Šå…¨é‡‡ç”¨ARM+FPGAçš„å¼€å‘å½¢å¼ï¼ŒARMä¾§åšçº¯ç²¹çš„è½¯ä»¶åº”ç”¨é€»è¾‘ï¼ŒFPGAæ§åˆ¶åº•å±‚çš„ç¡¬ä»¶ã€‚ARMå’ŒFPGAé‡‡ç”¨FMCæ¥å£è¿›è¡Œé€šè®¯ï¼Œé€šè¿‡å†…å­˜æ˜ å°„çš„æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè¿™æ ·ARMå¯ä»¥å¾ˆæ–¹ä¾¿çš„å’ŒFPGAè¿›è¡Œé€šè®¯ã€‚å½“å¹´ç”±äºèƒ½åŠ›æœ‰é™ï¼Œæˆ‘å¹¶æ²¡æœ‰å¤ªæ·±å…¥çš„å»äº†è§£è¿™å…¶ä¸­çš„é€šè®¯åŸç†ã€‚ä¸»è¦æ˜¯å½“æ—¶å¼€å‘ARMçš„å’Œå¼€å‘FPGAçš„æ˜¯ä¸¤æ‹¨äººï¼Œæˆ‘ä¸»è¦è´Ÿè´£ARMè½¯ä»¶çš„å¼€å‘ï¼Œå¹¶æ²¡æœ‰æœºä¼šæ¥è§¦åˆ°FPGAå¼€å‘ï¼Œåæ¥è§‰å¾—éå¸¸çš„é—æ†¾ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªå°é¡¹ç›®çš„å¼€å‘ç»å†ä¹Ÿç®—æ˜¯å¼¥è¡¥äº†å½“å¹´æœªèƒ½æ·±å…¥å‚ä¸å¼€å‘çš„ä¸€äº›é—æ†¾ã€‚æœŸå¾…å°†é¡¹ç›®ä¸­å¾—åˆ°çš„ç»éªŒåº”ç”¨åˆ°å®é™…å·¥ä½œä¸­ï¼Œè¿›ä¸€æ­¥æ¢ç´¢FPGAåœ¨åµŒå…¥å¼é¢†åŸŸçš„åº”ç”¨ã€‚</p>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                ä»å•ç‰‡æœºåˆ°FPGAï¼šæˆ‘çš„RISC-Vè½¯æ ¸å¼€å‘å®è·µ
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2025/05/16/ä»å•ç‰‡æœºåˆ°FPGAï¼šæˆ‘çš„RISC-Vè½¯æ ¸å¼€å‘å®è·µ/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    ä½œè€…
                </div>
                <div class="content">è€€çœ¼çš„å¤§ç¥</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    å‘å¸ƒäº
                </div>
                <div class="content">2025-05-16 16:16</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    è®¸å¯
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/08/01/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%BA%93%E4%B9%8Bmbedtls/"
                                   title="åŠ å¯†ç®—æ³•åº“ä¹‹mbedtls"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">åŠ å¯†ç®—æ³•åº“ä¹‹mbedtls</span>
                                        <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/03/08/PIO%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C/"
                                   title="PIOå‚è€ƒæ‰‹å†Œ"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">PIOå‚è€ƒæ‰‹å†Œ</span>
                                        <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">è€€çœ¼çš„å¤§ç¥</a>
        
    </div>

    <div class="theme-info info-item">
        ç”±&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;é©±åŠ¨&nbsp;&&nbsp;ä¸»é¢˜&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">è®¿å®¢æ•°</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
</main>





<!-- common js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/header-shrink.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/back2top.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/toggle-theme.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/code-block.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/local-search.min.js"></script>


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/post-helper.min.js"></script>

        <!-- toc -->
        

        <!-- copyright-info -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/copyright-info.min.js"></script>
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
